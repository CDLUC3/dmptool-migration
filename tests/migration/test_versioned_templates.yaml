test_versioned_templates:
  model: migration.versioned_templates

  inputs:
    dmp.orgs:
      rows:
        - id: 1
          name: "Example University"

        - id: 2
          name: "Another University"

    dmp.registry_orgs:
      rows:
        - id: 1
          org_id: 2
          ror_id: "https://ror.org/xxxxxxxx"

    dmp.users:
      rows:
        - id: 1
          email: "admin@example.com"
          org_id: 1
          created_at: "2025-09-15 06:14:14"

        - id: 2
          email: "admin2@example.com"
          org_id: 1
          created_at: "2025-09-20 06:14:14"

        - id: 3
          email: "tester@example.com"
          org_id: 1
          created_at: "2025-09-15 06:14:14"

        - id: 4
          email: "super@example.com"
          org_id: 2
          created_at: "2025-09-15 06:14:14"

    dmp.users_perms:
      rows:
        - id: 1
          user_id: 1
          perm_id: 6

        - id: 2
          user_id: 2
          perm_id: 6

        - id: 3
          user_id: 3
          perm_id: 5

        - id: 4
          user_id: 4
          perm_id: 1

        - id: 5
          user_id: 4
          perm_id: 6

    migration.templates_pt_br:
      rows:
        - family_id: 12345

    migration.users:
      rows:
        - id: 12345
          email: "admin@example.com"

        - id: 9876
          email: "admin2@example.com"

        - id: 67890
          email: "tester2@example.com"

        - id: 54321
          email: "super@example.com"

    migration.templates:
      columns:
        customization_of: INT
      rows:
        - id: 1
          family_id: 12345

        - id: 2
          family_id: 98765

        - id: 3
          family_id: 54321

        - id: 4
          family_id: 67890

        - id: 5
          family_id: 90909

    dmp.templates:
      columns:
        customization_of: INT
      rows:
        - id: 1
          title: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          published: 1
          org_id: 1
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-01 01:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 1
          visibility: 0
          customization_of: null
          family_id: 12345
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 2
          title: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          published: 0
          org_id: 1
          locale: "en-US"
          is_default: 0
          created_at: "2025-08-01 01:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 0
          visibility: 0
          customization_of: null
          family_id: 12345
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 3
          title: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          published: 1
          org_id: 1
          locale: "pt-BR"
          is_default: 0
          created_at: "2025-09-01 02:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 2
          visibility: 1
          customization_of: null
          family_id: 98765
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 4
          title: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          published: 0
          org_id: 1
          locale: "pt-BR"
          is_default: 0
          created_at: "2025-08-02 02:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 1
          visibility: 1
          customization_of: null
          family_id: 98765
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 5
          title: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          published: 0
          org_id: 1
          locale: "pt-BR"
          is_default: 0
          created_at: "2025-07-02 02:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 0
          visibility: 1
          customization_of: null
          family_id: 98765
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 6
          title: "Unpublished Template"
          description: "<p class=\"Normal\">Test unpublished template</p>"
          published: 0
          org_id: 1
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-03 03:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 0
          visibility: 1
          customization_of: null
          family_id: 54321
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 7
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 0
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2025-01-01 04:14:14"
          updated_at: "2025-01-01 11:33:17"
          version: 2
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 8
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 1
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2024-01-01 04:14:14"
          updated_at: "2025-01-01 11:33:17"
          version: 1
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 9
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 0
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2023-01-01 04:14:14"
          updated_at: "2025-01-01 11:33:17"
          version: 0
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 10
          title: "Customization of a Template"
          description: "<p class=\"Normal\">Template customization</p>"
          published: 1
          org_id: 2
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-15 05:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 1
          visibility: 0
          customization_of: 67890
          family_id: 90909
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

  outputs:
    query:
      rows:
        - id: 1
          family_id: 67890
          template_id: 4
          active: 0
          version: "v0"
          versionType: "PUBLISHED"
          versionedById: 54321
          name: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          ownerId: "https://ror.org/xxxxxxxx"
          visibility: "PUBLIC"
          bestPractice: true
          languageId: 'en-US'
          created: "2023-01-01 04:14:14"
          createdById: 54321
          modified: "2025-01-01 11:33:17"
          modifiedById: 54321

        - id: 2
          family_id: 67890
          template_id: 4
          active: 0
          version: "v1"
          versionType: "PUBLISHED"
          versionedById: 54321
          name: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          ownerId: "https://ror.org/xxxxxxxx"
          visibility: "PUBLIC"
          bestPractice: true
          languageId: 'en-US'
          created: "2024-01-01 04:14:14"
          createdById: 54321
          modified: "2025-01-01 11:33:17"
          modifiedById: 54321

        - id: 3
          family_id: 67890
          template_id: 4
          active: 1
          version: "v2"
          versionType: "PUBLISHED"
          versionedById: 54321
          name: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          ownerId: "https://ror.org/xxxxxxxx"
          visibility: "PUBLIC"
          bestPractice: true
          languageId: 'en-US'
          created: "2025-01-01 04:14:14"
          createdById: 54321
          modified: "2025-01-01 11:33:17"
          modifiedById: 54321

        - id: 4
          family_id: 98765
          template_id: 2
          active: 0
          version: "v0"
          versionType: "PUBLISHED"
          versionedById: 9876
          name: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          ownerId: "https://dmptool.org/affiliations/1"
          visibility: "PUBLIC"
          bestPractice: false
          languageId: 'pt-BR'
          created: "2025-07-02 02:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876

        - id: 5
          family_id: 12345
          template_id: 1
          active: 0
          version: "v0"
          versionType: "PUBLISHED"
          versionedById: 9876
          name: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          ownerId: "https://dmptool.org/affiliations/1"
          visibility: "ORGANIZATIONAL"
          bestPractice: false
          languageId: 'pt-BR'
          created: "2025-08-01 01:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876

        - id: 6
          family_id: 98765
          template_id: 2
          active: 0
          version: "v1"
          versionType: "PUBLISHED"
          versionedById: 9876
          name: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          ownerId: "https://dmptool.org/affiliations/1"
          visibility: "PUBLIC"
          bestPractice: false
          languageId: 'pt-BR'
          created: "2025-08-02 02:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876

        - id: 7
          family_id: 12345
          template_id: 1
          active: 1
          version: "v1"
          versionType: "PUBLISHED"
          versionedById: 9876
          name: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          ownerId: "https://dmptool.org/affiliations/1"
          visibility: "ORGANIZATIONAL"
          bestPractice: false
          languageId: 'pt-BR'
          created: "2025-09-01 01:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876

        - id: 8
          family_id: 98765
          template_id: 2
          active: 1
          version: "v2"
          versionType: "PUBLISHED"
          versionedById: 9876
          name: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          ownerId: "https://dmptool.org/affiliations/1"
          visibility: "PUBLIC"
          bestPractice: false
          languageId: 'pt-BR'
          created: "2025-09-02 02:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876
