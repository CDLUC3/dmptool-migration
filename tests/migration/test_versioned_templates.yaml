test_templates:
  model: migration.versioned_templates

  inputs:
    dmp.registry_orgs:
      rows:
        - id: 1
          org_id: 2
          ror_id: "https://ror.org/xxxxxxxx"

    migration.templates_pt_br:
      columns:
        family_id: INT
      rows:
        - family_id: 12345

    intermediate.templates:
      columns:
        family_id: INT
        old_template_id: INT
        old_org_id: INT
        old_created_at: DATETIME
        customization_of_family_id: INT
        best_practice: BOOLEAN
        is_published: BOOLEAN
        was_published: BOOLEAN
        old_updated_at: DATETIME
        visibility: INT
        version: INT
        is_current_template: BOOLEAN
        new_created_by_id: INT
      rows:
        - family_id: 12345
          old_template_id: 1
          old_org_id: 1
          old_created_at: "2025-09-01 01:14:14"
          customization_of_family_id: null
          best_practice: 0
          is_published: 1
          was_published: 0
          old_updated_at: "2025-09-15 11:33:17"
          visibility: 0
          version: 1
          is_current_template: 1
          new_created_by_id: 9876

        - family_id: 98765
          old_template_id: 2
          old_org_id: 1
          old_created_at: "2025-09-02 02:14:14"
          customization_of_family_id: null
          best_practice: 0
          is_published: 1
          was_published: 0
          old_updated_at: "2025-09-15 11:33:17"
          visibility: 1
          version: 2
          is_current_template: 1
          new_created_by_id: 9876

        - family_id: 54321
          old_template_id: 3
          old_org_id: 1
          old_created_at: "2025-09-03 03:14:14"
          customization_of_family_id: null
          best_practice: 0
          is_published: 0
          was_published: 0
          old_updated_at: "2025-09-15 11:33:17"
          visibility: 1
          version: 1
          is_current_template: 1
          new_created_by_id: 9876

        - family_id: 67890
          old_template_id: 6
          old_org_id: 2
          old_created_at: "2025-01-01 04:14:14"
          customization_of_family_id: null
          best_practice: 1
          is_published: 0
          was_published: 0
          old_updated_at: "2025-01-01 11:33:17"
          visibility: 1
          version: 5
          is_current_template: 1
          new_created_by_id: 54321

        - family_id: 67890
          old_template_id: 5
          old_org_id: 2
          old_created_at: "2024-01-01 04:14:14"
          customization_of_family_id: null
          best_practice: 1
          is_published: 1
          was_published: 0
          old_updated_at: "2024-01-01 11:33:17"
          visibility: 1
          version: 4
          is_current_template: 0
          new_created_by_id: 54321

        - family_id: 67890
          old_template_id: 4
          old_org_id: 2
          old_created_at: "2023-01-01 04:14:14"
          customization_of_family_id: null
          best_practice: 1
          is_published: 0
          was_published: 1
          old_updated_at: "2023-01-01 11:33:17"
          visibility: 1
          version: 3
          is_current_template: 0
          new_created_by_id: 54321

        - family_id: 90909
          old_template_id: 7
          old_org_id: 2
          old_created_at: "2025-01-01 04:14:14"
          customization_of_family_id: 67890
          best_practice: 0
          is_published: 1
          old_updated_at: "2025-09-15 11:33:17"
          visibility: 0
          version: 1
          was_published: 0
          is_current_template: 1
          new_created_by_id: 54321

    migration.templates:
      columns:
        id: INT
        old_family_id: INT
      rows:
        - id: 1
          old_family_id: 12345

        - id: 2
          old_family_id: 67890

        - id: 3
          old_family_id: 98765

    dmp.templates:
      columns:
        id: INT
        title: VARCHAR
        description: MEDIUMTEXT
        customization_of: INT
        published: BOOLEAN
        org_id: INT
        locale: VARCHAR
        is_default: BOOLEAN
        created_at: DATETIME
        updated_at: DATETIME
        version: INT
        visibility: INT
        family_id: INT
        archived: BOOLEAN
        links: JSON
      rows:
        - id: 1
          title: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          published: 1
          org_id: 1
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-01 01:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 1
          visibility: 0
          customization_of: null
          family_id: 12345
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 2
          title: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          published: 1
          org_id: 1
          locale: "pt-BR"
          is_default: 0
          created_at: "2025-09-02 02:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 2
          visibility: 1
          customization_of: null
          family_id: 98765
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 3
          title: "Unpublished Template"
          description: "<p class=\"Normal\">Test unpublished template</p>"
          published: 0
          org_id: 1
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-03 03:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 0
          visibility: 1
          customization_of: null
          family_id: 54321
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"

        - id: 6
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 0
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2025-01-01 04:14:14"
          updated_at: "2025-01-01 11:33:17"
          version: 5
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 5
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 1
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2024-01-01 04:14:14"
          updated_at: "2024-01-01 11:33:17"
          version: 4
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 4
          title: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          published: 0
          org_id: 2
          locale: "en-US"
          is_default: 1
          created_at: "2023-01-01 04:14:14"
          updated_at: "2023-01-01 11:33:17"
          version: 3
          visibility: 1
          customization_of: null
          family_id: 67890
          archived: 0
          links: "{\"funder\":[{\"link\":\"https://www.example.com/funder\",\"text\":\"Example\"}],\"sample_plan\":[{\"link\":\"https://www.example.com/sample\",\"text\":\"Sample\"}]}"

        - id: 7
          title: "Customization of a Template"
          description: "<p class=\"Normal\">Template customization</p>"
          published: 1
          org_id: 2
          locale: "en-US"
          is_default: 0
          created_at: "2025-09-15 05:14:14"
          updated_at: "2025-09-15 11:33:17"
          version: 1
          visibility: 0
          customization_of: 67890
          family_id: 90909
          archived: 0
          links: "{\"funder\":[],\"sample_plan\":[]}"
  outputs:
    query:
      rows:
        - id: 1
          old_template_id: 4
          old_family_id: 67890
          template_id: 2
          active: 0
          version: "v3"
          versionType: 'PUBLISHED'
          versionedById: 54321
          visibility: "PUBLIC"
          comment: null
          name: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          bestPractice: true
          ownerId: "https://ror.org/xxxxxxxx"
          languageId: 'en-US'
          created: "2023-01-01 04:14:14"
          createdById: 54321
          modified: "2023-01-01 11:33:17"
          modifiedById: 54321

        - id: 2
          old_template_id: 5
          old_family_id: 67890
          template_id: 2
          active: 1
          version: "v4"
          versionType: 'PUBLISHED'
          versionedById: 54321
          visibility: "PUBLIC"
          comment: null
          name: "Best Practice Template"
          description: "<p class=\"Normal\">Test best practice template</p>"
          bestPractice: true
          ownerId: "https://ror.org/xxxxxxxx"
          languageId: 'en-US'
          created: "2024-01-01 04:14:14"
          createdById: 54321
          modified: "2024-01-01 11:33:17"
          modifiedById: 54321

        - id: 3
          old_template_id: 1
          old_family_id: 12345
          template_id: 1
          active: 1
          version: "v1"
          versionType: 'PUBLISHED'
          versionedById: 9876
          visibility: "ORGANIZATIONAL"
          comment: null
          name: "Published Organizational Template"
          description: "<p class=\"Normal\">Test published organizational template</p>"
          bestPractice: false
          ownerId: "https://dmptool.org/affiliations/1"
          languageId: 'pt-BR'
          created: "2025-09-01 01:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876

        - id: 4
          old_template_id: 2
          old_family_id: 98765
          template_id: 3
          active: 1
          version: "v2"
          versionType: 'PUBLISHED'
          versionedById: 9876
          visibility: "PUBLIC"
          comment: null
          name: "Published Public Template"
          description: "<p class=\"Normal\">Test published template</p>"
          bestPractice: false
          ownerId: "https://dmptool.org/affiliations/1"
          languageId: 'pt-BR'
          created: "2025-09-02 02:14:14"
          createdById: 9876
          modified: "2025-09-15 11:33:17"
          modifiedById: 9876
