test_template_links:
  model: migration.template_links

  vars:
    super_admin_id: 999

  # -- Input data simulating source tables and variables
  inputs:
    dmp.templates:
      columns:
        id: INT
      rows:
        - id: 1
        - id: 2
        - id: 3

    migration.templates:
      columns:
        id: INT
        family_id: INT
      rows:
        - id: 10
          createdById: 999
          created: '2024-01-02 11:00:00'
          modifiedById: 999
          modified: '2024-01-02 11:00:00'

        - id: 11
          createdById: 999
          created: '2024-01-06 11:00:00'
          modifiedById: 999
          modified: '2024-01-06 11:00:00'

    intermediate.templates:
      columns:
        id: INT
        oldTemplateId: INT
        newTemplateId: INT
        is_current_template: BOOLEAN

      rows:
        - id: 1
          oldTemplateId: 1
          newTemplateId: 10
          is_current_template: true

        - id: 2
          oldTemplateId: 2
          newTemplateId: 11
          is_current_template: true

        - id: 3
          oldTemplateId: 3
          newTemplateId: 12
          is_current_template: false

    intermediate.template_links:
      columns:
        id: INT
        templateId: INT
        linkType: VARCHAR
        url: VARCHAR
        text: VARCHAR
        createdById: INT
        created: DATETIME
      rows:
        - id: 1
          templateId: 10
          linkType: 'FUNDER'
          url: 'https://dot.gov/plan1'
          text: 'DOT Plan'
          createdById: 999
          created: '2024-01-01 10:00:00'

        - id: 2
          templateId: 10
          linkType: 'SAMPLE_PLAN'
          url: 'https://ntl.bts.gov/sample1'
          text: 'Sample Plan'
          createdById: 999
          created: '2024-01-01 10:00:00'

        - id: 3
          templateId: 11
          linkType: 'FUNDER'
          url: 'https://dot.gov/plan2'
          text: 'DOT Plan 2'
          createdById: 999
          created: '2024-01-05 10:00:00'

        - id: 4
          templateId: 12
          linkType: 'SAMPLE'
          url: 'https://sample.only'
          text: 'Only Sample'
          createdById: 999
          created: '2024-01-10 09:00:00'

  # -- Expected output data
  outputs:
    query:
      rows:
        # Record from template 1 (FUNDER link)
        - id: 1
          templateId: 10
          linkType: 'FUNDER'
          url: 'https://dot.gov/plan1'
          text: 'DOT Plan'
          createdById: 999
          created: '2024-01-01 10:00:00'
          modifiedById: 999
          modified: '2024-01-02 11:00:00'
        # Record from template 1 (SAMPLE link)
        - id: 2
          templateId: 10
          linkType: 'SAMPLE_PLAN'
          url: 'https://ntl.bts.gov/sample1'
          text: 'Sample Plan'
          createdById: 999
          created: '2024-01-01 10:00:00'
          modifiedById: 999
          modified: '2024-01-02 11:00:00'
        # Record from template 2 (FUNDER only)
        - id: 3
          templateId: 11
          linkType: 'FUNDER'
          url: 'https://dot.gov/plan2'
          text: 'DOT Plan 2'
          createdById: 999
          created: '2024-01-05 10:00:00'
          modifiedById: 999
          modified: '2024-01-06 11:00:00'
        # Record from template 3 (SAMPLE only)
        - id: 4
          templateId: 12
          linkType: 'SAMPLE'
          url: 'https://sample.only'
          text: 'Only Sample'
          createdById: 999
          created: '2024-01-10 09:00:00'
          modifiedById: 999
          modified: '2024-01-10 09:30:00'

  # -- Optional: test expectations for audits
  audits:
    - name: not_null
      arguments:
        columns:
          - templateId
          - linkType
          - url
          - text
          - created
          - createdById
          - modified
          - modifiedById
      expect_pass: true
