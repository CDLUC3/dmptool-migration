test_affiliation_links:
  model: migration.affiliation_links

  inputs:
    dmp.orgs:
      columns:
        links: TEXT
      rows:
        - id: 1
          links: NULL
          created_at: "2020-01-01 00:00:00"
          updated_at: "2020-02-01 00:00:00"
        - id: 1
          links: ''
          created_at: "2021-01-01 00:00:00"
          updated_at: "2021-02-01 00:00:00"
        - id: 3
          links: '{}'
          created_at: "2022-01-01 00:00:00"
          updated_at: "2022-02-01 00:00:00"
        - id: 4
          links: '{"org":[]}'
          created_at: "2023-01-01 00:00:00"
          updated_at: "2023-02-01 00:00:00"
        - id: 5
          links: '{"org":[{"link":"https://example.edu/dmp/","text":"Text A"},{"link": "", "text":"Text B"},{}]}'
          created_at: "2024-01-01 00:00:00"
          updated_at: "2024-02-01 00:00:00"
        - id: 6
          links: '{"org":[{"link":"https://example.ac.nz/dmp/","text":"Text C"},{"link":"https://example.edu.au/dmp/","text":"Text D"}]}'
          created_at: "2025-01-01 00:00:00"
          updated_at: "2025-02-01 00:00:00"

    dmp.registry_orgs:
      - id: 50
        org_id: 5
        ror_id: "https://ror.org/abc123"

  outputs:
    query:
      rows:
        - id: 1
          affiliationId: "https://ror.org/abc123"
          url: "https://example.edu/dmp/"
          text: "Text B"
          createdById: 1
          created: "2024-01-01 00:00:00"
          modifiedById: 1
          modified: "2024-02-01 00:00:00"
        - id: 2
          affiliationId: "https://dmptool.org/affiliations/6"
          url: "https://example.ac.nz/dmp/"
          text: "Text C"
          createdById: 1
          created: "2024-01-01 00:00:00"
          modifiedById: 1
          modified: "2024-02-01 00:00:00"
        - id: 3
          affiliationId: "https://dmptool.org/affiliations/6"
          url: "https://example.edu.au/dmp/"
          text: "Text D"
          createdById: 1
          created: "2025-01-01 00:00:00"
          modifiedById: 1
          modified: "2025-02-01 00:00:00"

